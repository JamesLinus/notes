package main

import (
	"bytes"
	"compress/flate"
	"compress/gzip"
	"compress/zlib"
	"fmt"
	"io/ioutil"
	"time"
)

var teststr = `{"Id":10934,"Version":7,"RandomSeed":884671956,"UserId":1018,"Star":3,"Percent":100,"MyId":1018,"MyLevel":10,"MyPubLevel":5,"MyName":"蛋蛋","TargetUser":{"Id":691,"UUID":"ROBOT4472475080583284104","Domain":"IE007一区","GroupId":0,"Name":"Bing108","Level":6,"EXP":1,"Flag":1,"Guide":0,"LastRankReward":0,"Gacha":{"X0":1550133100},"PVPSeed":{"X0":1550133240},"LastRank":0,"FreeGacha":1,"AttackWin":0,"DefenseWin":0,"PM12":1389185242,"Island":5,"CUP":97,"PVP":5,"ProtectTimeout":1386959170,"LastSaveTime":1386959170,"CountryCode":"","REGIP":"127.0.0.1","Language":"","DeviceType":"","Buffs":[],"CreatedAt":1386959170,"VIP":{"Credits":0,"Level":0,"LastResOut":0,"VIPHouseDrops":0,"VIPHouseDestroys":0,"PrivLevel":0,"PrivExpire":0},"Stats":{"LastLoginAt":1386959170,"ThisLoginAt":0,"Continuoulogin":0}},"Food":21999.99999999998,"Gold":21872.592592592544,"CUP":3,"SelectedHero":2,"MyHero":{"Soldiers":{"11":10,"12":10},"Armour":31,"Weapon":31,"Banner":31,"Necklace":null,"Decoration":null,"Ring":null,"InActiveSkill":[],"Slot1":4,"Slot2":5,"Slot3":6},"MySoldiers":{"UserId":1018,"Version":25,"Soldiers":{"11":{"Armour":31,"Weapon":31},"12":{"Armour":31,"Weapon":31},"13":{"Armour":1,"Weapon":1},"14":{"Armour":1,"Weapon":1}}},"VIPLevel":0,"MyWorkItems":null,"TargetWorkItems":null,"LastFrame":5268,"Actions":[{"TYPE":2,"Frame":525,"X":17,"Y":19},{"TYPE":2,"Frame":541,"X":20,"Y":21},{"TYPE":2,"Frame":625,"X":20,"Y":21},{"TYPE":1,"Frame":647,"X":0,"Y":0,"Parm":"skill5"},{"TYPE":2,"Frame":660,"X":20,"Y":22},{"TYPE":2,"Frame":706,"X":20,"Y":21},{"TYPE":2,"Frame":712,"X":20,"Y":21},{"TYPE":2,"Frame":724,"X":20,"Y":21},{"TYPE":1,"Frame":883,"X":0,"Y":0,"Parm":"skill5"},{"TYPE":2,"Frame":909,"X":24,"Y":29},{"TYPE":2,"Frame":930,"X":20,"Y":22},{"TYPE":2,"Frame":968,"X":24,"Y":29},{"TYPE":2,"Frame":1004,"X":24,"Y":27},{"TYPE":2,"Frame":1019,"X":23,"Y":28},{"TYPE":2,"Frame":1023,"X":23,"Y":28},{"TYPE":2,"Frame":1026,"X":23,"Y":28},{"TYPE":2,"Frame":1031,"X":23,"Y":29},{"TYPE":2,"Frame":1035,"X":23,"Y":29},{"TYPE":2,"Frame":1040,"X":23,"Y":30},{"TYPE":2,"Frame":1044,"X":23,"Y":30},{"TYPE":1,"Frame":1072,"X":0,"Y":0,"Parm":"skill4"},{"TYPE":2,"Frame":1081,"X":24,"Y":29},{"TYPE":1,"Frame":1102,"X":0,"Y":0,"Parm":"skill4"},{"TYPE":2,"Frame":1116,"X":30,"Y":29},{"TYPE":2,"Frame":1167,"X":25,"Y":29},{"TYPE":2,"Frame":1175,"X":24,"Y":29},{"TYPE":2,"Frame":1179,"X":24,"Y":29},{"TYPE":2,"Frame":1185,"X":24,"Y":30},{"TYPE":2,"Frame":1193,"X":30,"Y":30},{"TYPE":2,"Frame":1198,"X":30,"Y":30},{"TYPE":2,"Frame":1201,"X":30,"Y":29},{"TYPE":2,"Frame":1211,"X":25,"Y":30},{"TYPE":2,"Frame":1216,"X":25,"Y":30},{"TYPE":2,"Frame":1221,"X":25,"Y":30},{"TYPE":1,"Frame":1239,"X":0,"Y":0,"Parm":"skill5"},{"TYPE":2,"Frame":1273,"X":30,"Y":29},{"TYPE":1,"Frame":1299,"X":0,"Y":0,"Parm":"skill4"},{"TYPE":2,"Frame":1309,"X":30,"Y":29},{"TYPE":2,"Frame":1351,"X":30,"Y":29},{"TYPE":1,"Frame":1366,"X":0,"Y":0,"Parm":"skill5"},{"TYPE":2,"Frame":1434,"X":24,"Y":26},{"TYPE":1,"Frame":1505,"X":0,"Y":0,"Parm":"skill5"},{"TYPE":2,"Frame":1520,"X":30,"Y":29},{"TYPE":2,"Frame":1539,"X":30,"Y":29},{"TYPE":2,"Frame":1561,"X":23,"Y":29},{"TYPE":2,"Frame":1585,"X":29,"Y":29},{"TYPE":2,"Frame":1590,"X":29,"Y":29},{"TYPE":2,"Frame":1595,"X":30,"Y":29},{"TYPE":2,"Frame":1599,"X":30,"Y":29},{"TYPE":2,"Frame":1605,"X":30,"Y":29},{"TYPE":2,"Frame":1882,"X":31,"Y":26},{"TYPE":1,"Frame":1917,"X":0,"Y":0,"Parm":"skill4"},{"TYPE":2,"Frame":1946,"X":28,"Y":29},{"TYPE":1,"Frame":1968,"X":0,"Y":0,"Parm":"skill5"},{"TYPE":2,"Frame":2006,"X":34,"Y":22},{"TYPE":2,"Frame":2040,"X":34,"Y":22},{"TYPE":1,"Frame":2075,"X":0,"Y":0,"Parm":"skill4"},{"TYPE":2,"Frame":2450,"X":35,"Y":22},{"TYPE":2,"Frame":2499,"X":28,"Y":21},{"TYPE":2,"Frame":2518,"X":20,"Y":19},{"TYPE":1,"Frame":2608,"X":0,"Y":0,"Parm":"skill5"},{"TYPE":2,"Frame":2636,"X":20,"Y":19},{"TYPE":2,"Frame":2671,"X":20,"Y":19},{"TYPE":2,"Frame":2713,"X":20,"Y":19},{"TYPE":2,"Frame":2778,"X":20,"Y":20},{"TYPE":2,"Frame":3151,"X":21,"Y":23},{"TYPE":2,"Frame":3236,"X":24,"Y":20},{"TYPE":2,"Frame":3302,"X":23,"Y":16},{"TYPE":2,"Frame":3312,"X":23,"Y":15},{"TYPE":2,"Frame":3338,"X":19,"Y":16},{"TYPE":2,"Frame":3420,"X":22,"Y":16},{"TYPE":2,"Frame":3715,"X":24,"Y":15},{"TYPE":2,"Frame":3929,"X":26,"Y":14},{"TYPE":2,"Frame":4256,"X":30,"Y":17},{"TYPE":2,"Frame":4272,"X":31,"Y":15},{"TYPE":1,"Frame":4365,"X":0,"Y":0,"Parm":"skill5"},{"TYPE":1,"Frame":4382,"X":0,"Y":0,"Parm":"skill6"},{"TYPE":2,"Frame":4480,"X":21,"Y":29},{"TYPE":2,"Frame":4520,"X":22,"Y":29},{"TYPE":2,"Frame":4565,"X":33,"Y":29},{"TYPE":2,"Frame":4588,"X":32,"Y":19},{"TYPE":2,"Frame":4613,"X":21,"Y":29},{"TYPE":2,"Frame":4653,"X":20,"Y":29},{"TYPE":2,"Frame":4724,"X":33,"Y":29},{"TYPE":1,"Frame":4750,"X":0,"Y":0,"Parm":"skill4"},{"TYPE":2,"Frame":4768,"X":33,"Y":29},{"TYPE":2,"Frame":4867,"X":33,"Y":29},{"TYPE":1,"Frame":4892,"X":0,"Y":0,"Parm":"skill4"},{"TYPE":2,"Frame":4904,"X":33,"Y":29},{"TYPE":1,"Frame":5183,"X":0,"Y":0,"Parm":"skill4"},{"TYPE":2,"Frame":5193,"X":33,"Y":29}],"APS":{"11":{"HP":2520,"DPS":1400},"12":{"HP":1140,"DPS":1840},"2":{"HP":6311,"DPS":84}},"TargetFoodStore":50000,"TargetGoldStore":50000,"TargetHeroes":{"UserId":691,"Version":2,"Selected":1,"Heroes":{"1":{"Soldiers":{},"Armour":1,"Weapon":1,"Banner":1,"Necklace":null,"Decoration":null,"Ring":null,"InActiveSkill":[],"Slot1":2,"Slot2":0,"Slot3":0}},"Knapsack":null,"LastEquipId":0,"SkillPoints":0},"TargetBuilds":{"UserId":691,"Version":24,"BaseRedif":36,"T0Redif":1389185242,"BasePopu":28800,"T0Popu":1389185242,"Gold":10000,"Food":10000,"Builds":{"1":{"TYPE":"tribeHall","Y":12,"X":25,"Level":5,"Base":0,"T0":0,"Buff":0},"10":{"TYPE":"viphouse","Y":29,"X":14,"Level":0,"Base":0,"T0":0,"Buff":0},"11":{"TYPE":"mine","Y":28,"X":32,"Level":5,"Base":6000,"T0":1389185242,"Buff":0},"12":{"TYPE":"road","Y":27,"X":31,"Level":0,"Base":0,"T0":0,"Buff":0},"13":{"TYPE":"road","Y":27,"X":32,"Level":0,"Base":0,"T0":0,"Buff":0},"14":{"TYPE":"road","Y":30,"X":28,"Level":0,"Base":0,"T0":0,"Buff":0},"15":{"TYPE":"road","Y":31,"X":28,"Level":0,"Base":0,"T0":0,"Buff":0},"16":{"TYPE":"road","Y":32,"X":28,"Level":0,"Base":0,"T0":0,"Buff":0},"17":{"TYPE":"road","Y":33,"X":28,"Level":0,"Base":0,"T0":0,"Buff":0},"18":{"TYPE":"road","Y":19,"X":22,"Level":0,"Base":0,"T0":0,"Buff":0},"19":{"TYPE":"road","Y":27,"X":27,"Level":0,"Base":0,"T0":0,"Buff":0},"2":{"TYPE":"barrack","Y":24,"X":33,"Level":5,"Base":0,"T0":0,"Buff":0},"20":{"TYPE":"road","Y":17,"X":24,"Level":0,"Base":0,"T0":0,"Buff":0},"21":{"TYPE":"road","Y":18,"X":22,"Level":0,"Base":0,"T0":0,"Buff":0},"22":{"TYPE":"road","Y":27,"X":25,"Level":0,"Base":0,"T0":0,"Buff":0},"23":{"TYPE":"road","Y":17,"X":22,"Level":0,"Base":0,"T0":0,"Buff":0},"24":{"TYPE":"road","Y":35,"X":28,"Level":0,"Base":0,"T0":0,"Buff":0},"25":{"TYPE":"road","Y":20,"X":22,"Level":0,"Base":0,"T0":0,"Buff":0},"28":{"TYPE":"road","Y":27,"X":23,"Level":0,"Base":0,"T0":0,"Buff":0},"29":{"TYPE":"road","Y":23,"X":32,"Level":0,"Base":0,"T0":0,"Buff":0},"3":{"TYPE":"cottage","Y":14,"X":22,"Level":5,"Base":0,"T0":0,"Buff":0},"30":{"TYPE":"pedrero","Y":28,"X":23,"Level":5,"Base":0,"T0":0,"Buff":0},"31":{"TYPE":"pedrero","Y":28,"X":29,"Level":5,"Base":0,"T0":0,"Buff":0},"32":{"TYPE":"road","Y":29,"X":28,"Level":0,"Base":0,"T0":0,"Buff":0},"33":{"TYPE":"road","Y":27,"X":29,"Level":0,"Base":0,"T0":0,"Buff":0},"34":{"TYPE":"road","Y":34,"X":28,"Level":0,"Base":0,"T0":0,"Buff":0},"35":{"TYPE":"road","Y":25,"X":32,"Level":0,"Base":0,"T0":0,"Buff":0},"36":{"TYPE":"road","Y":17,"X":25,"Level":0,"Base":0,"T0":0,"Buff":0},"37":{"TYPE":"road","Y":27,"X":28,"Level":0,"Base":0,"T0":0,"Buff":0},"38":{"TYPE":"blacksmith","Y":14,"X":33,"Level":5,"Base":0,"T0":0,"Buff":0},"39":{"TYPE":"farm","Y":14,"X":30,"Level":5,"Base":6000,"T0":1389185242,"Buff":0},"4":{"TYPE":"farm","Y":15,"X":19,"Level":5,"Base":6000,"T0":1389185242,"Buff":0},"40":{"TYPE":"archerTower","Y":21,"X":33,"Level":5,"Base":0,"T0":0,"Buff":0},"41":{"TYPE":"road","Y":17,"X":23,"Level":0,"Base":0,"T0":0,"Buff":0},"42":{"TYPE":"road","Y":24,"X":32,"Level":0,"Base":0,"T0":0,"Buff":0},"43":{"TYPE":"road","Y":17,"X":26,"Level":0,"Base":0,"T0":0,"Buff":0},"44":{"TYPE":"road","Y":17,"X":27,"Level":0,"Base":0,"T0":0,"Buff":0},"45":{"TYPE":"road","Y":17,"X":28,"Level":0,"Base":0,"T0":0,"Buff":0},"46":{"TYPE":"road","Y":17,"X":29,"Level":0,"Base":0,"T0":0,"Buff":0},"47":{"TYPE":"road","Y":25,"X":22,"Level":0,"Base":0,"T0":0,"Buff":0},"48":{"TYPE":"road","Y":26,"X":22,"Level":0,"Base":0,"T0":0,"Buff":0},"49":{"TYPE":"road","Y":27,"X":22,"Level":0,"Base":0,"T0":0,"Buff":0},"5":{"TYPE":"granary","Y":18,"X":33,"Level":5,"Base":0,"T0":0,"Buff":0},"50":{"TYPE":"road","Y":28,"X":26,"Level":0,"Base":0,"T0":0,"Buff":0},"51":{"TYPE":"road","Y":29,"X":26,"Level":0,"Base":0,"T0":0,"Buff":0},"52":{"TYPE":"road","Y":30,"X":26,"Level":0,"Base":0,"T0":0,"Buff":0},"53":{"TYPE":"road","Y":31,"X":26,"Level":0,"Base":0,"T0":0,"Buff":0},"54":{"TYPE":"road","Y":32,"X":26,"Level":0,"Base":0,"T0":0,"Buff":0},"55":{"TYPE":"road","Y":33,"X":26,"Level":0,"Base":0,"T0":0,"Buff":0},"56":{"TYPE":"road","Y":34,"X":26,"Level":0,"Base":0,"T0":0,"Buff":0},"57":{"TYPE":"road","Y":35,"X":26,"Level":0,"Base":0,"T0":0,"Buff":0},"58":{"TYPE":"road","Y":28,"X":27,"Level":0,"Base":0,"T0":0,"Buff":0},"59":{"TYPE":"road","Y":29,"X":27,"Level":0,"Base":0,"T0":0,"Buff":0},"6":{"TYPE":"mine","Y":28,"X":20,"Level":5,"Base":6000,"T0":1389185242,"Buff":0},"60":{"TYPE":"road","Y":30,"X":27,"Level":0,"Base":0,"T0":0,"Buff":0},"61":{"TYPE":"flag","Y":34,"X":29,"Level":255,"Base":0,"T0":0,"Buff":0},"62":{"TYPE":"windmill","Y":18,"X":37,"Level":255,"Base":0,"T0":0,"Buff":0},"63":{"TYPE":"flowerbed_1","Y":22,"X":23,"Level":255,"Base":0,"T0":0,"Buff":0},"64":{"TYPE":"flowerbed_2","Y":21,"X":27,"Level":255,"Base":0,"T0":0,"Buff":0},"65":{"TYPE":"firecracker","Y":31,"X":23,"Level":255,"Base":0,"T0":0,"Buff":0},"66":{"TYPE":"tree_green","Y":24,"X":24,"Level":255,"Base":0,"T0":0,"Buff":0},"67":{"TYPE":"tree_pink","Y":23,"X":29,"Level":255,"Base":0,"T0":0,"Buff":0},"68":{"TYPE":"tree_pink","Y":19,"X":24,"Level":255,"Base":0,"T0":0,"Buff":0},"69":{"TYPE":"tree_pink","Y":18,"X":28,"Level":255,"Base":0,"T0":0,"Buff":0},"7":{"TYPE":"pub","Y":24,"X":18,"Level":5,"Base":0,"T0":0,"Buff":0},"70":{"TYPE":"road","Y":31,"X":27,"Level":0,"Base":0,"T0":0,"Buff":0},"71":{"TYPE":"road","Y":32,"X":27,"Level":0,"Base":0,"T0":0,"Buff":0},"72":{"TYPE":"road","Y":33,"X":27,"Level":0,"Base":0,"T0":0,"Buff":0},"73":{"TYPE":"road","Y":34,"X":27,"Level":0,"Base":0,"T0":0,"Buff":0},"74":{"TYPE":"road","Y":35,"X":27,"Level":0,"Base":0,"T0":0,"Buff":0},"75":{"TYPE":"road","Y":28,"X":28,"Level":0,"Base":0,"T0":0,"Buff":0},"76":{"TYPE":"road","Y":20,"X":32,"Level":0,"Base":0,"T0":0,"Buff":0},"78":{"TYPE":"road","Y":19,"X":32,"Level":0,"Base":0,"T0":0,"Buff":0},"8":{"TYPE":"treasury","Y":18,"X":19,"Level":5,"Base":0,"T0":0,"Buff":0},"80":{"TYPE":"road","Y":18,"X":32,"Level":0,"Base":0,"T0":0,"Buff":0},"81":{"TYPE":"road","Y":17,"X":32,"Level":0,"Base":0,"T0":0,"Buff":0},"82":{"TYPE":"road","Y":22,"X":32,"Level":0,"Base":0,"T0":0,"Buff":0},"83":{"TYPE":"road","Y":27,"X":26,"Level":0,"Base":0,"T0":0,"Buff":0},"84":{"TYPE":"road","Y":26,"X":32,"Level":0,"Base":0,"T0":0,"Buff":0},"85":{"TYPE":"road","Y":27,"X":24,"Level":0,"Base":0,"T0":0,"Buff":0},"86":{"TYPE":"road","Y":21,"X":32,"Level":0,"Base":0,"T0":0,"Buff":0},"87":{"TYPE":"road","Y":27,"X":30,"Level":0,"Base":0,"T0":0,"Buff":0},"89":{"TYPE":"road","Y":17,"X":31,"Level":0,"Base":0,"T0":0,"Buff":0},"9":{"TYPE":"archerTower","Y":21,"X":19,"Level":5,"Base":0,"T0":0,"Buff":0},"94":{"TYPE":"road","Y":22,"X":22,"Level":0,"Base":0,"T0":0,"Buff":0},"95":{"TYPE":"road","Y":17,"X":30,"Level":0,"Base":0,"T0":0,"Buff":0},"96":{"TYPE":"road","Y":24,"X":22,"Level":0,"Base":0,"T0":0,"Buff":0},"97":{"TYPE":"road","Y":23,"X":22,"Level":0,"Base":0,"T0":0,"Buff":0},"98":{"TYPE":"road","Y":21,"X":22,"Level":0,"Base":0,"T0":0,"Buff":0}}},"Flag":3,"Timestamp":"2014-01-08T20:47:22.785117775+08:00"}`

func main() {
	fmt.Println(len([]byte(teststr)))

	// zlib
	var b1 bytes.Buffer
	w, err := zlib.NewWriterLevel(&b1, zlib.BestCompression)
	w.Write([]byte(teststr))
	w.Close()
	fmt.Println(b1.Len(), err)

	start := time.Now()
	dec1 := bytes.NewBuffer(b1.Bytes())
	r, _ := zlib.NewReader(dec1)
	ioutil.ReadAll(r)
	fmt.Println("decompress zlib", time.Now().Sub(start))

	// flate
	var b2 bytes.Buffer
	w2, err := flate.NewWriter(&b2, flate.BestCompression)
	w2.Write([]byte(teststr))
	w2.Close()
	fmt.Println(b2.Len(), err)

	start = time.Now()
	dec2 := bytes.NewBuffer(b2.Bytes())
	r = flate.NewReader(dec2)
	ioutil.ReadAll(r)
	fmt.Println("decompress deflate", time.Now().Sub(start))

	// gzip
	var b3 bytes.Buffer
	w3, _ := gzip.NewWriterLevel(&b3, gzip.BestCompression)
	w3.Write([]byte(teststr))
	w3.Close()
	fmt.Println(b3.Len(), err)

	start = time.Now()
	dec3 := bytes.NewBuffer(b3.Bytes())
	r, _ = gzip.NewReader(dec3)
	ioutil.ReadAll(r)
	fmt.Println("decompress gzip", time.Now().Sub(start))
}
